Client A        WS Server 1         Redis        NATS Pub/Sub        WS Server 2        Client B
   |                 |                 |               |                  |                 |
   |--- WebSocket --->|                 |               |                  |                 |
   |                 |--- SET user:123=online -------->|               |                  |
   |                 |                 |               |                  |                 |
   |                 |--- Publish(user:123 online) --->|----------------->|                  |
   |                 |                 |               |--- event ------->|--- notify B --->|
   |                 |                 |               |                  |                 |
   |  <--- pong ---- |                 |               |                  |                 |
   |--- ping ------->|                 |               |                  |                 |
   |                 |                 |               |                  |                 |
... (æŒçºŒé€£ç·š) ...
   |                 |                 |               |                  |                 |
[Client A é—œé–‰é€£ç·š/æ‰ç·š]
   |--- (disconnect)|                 |               |                  |                 |
   |                 |--- SET user:123=offline ------>|               |                  |
   |                 |--- Publish(user:123 offline) ->|----------------->|                  |
   |                 |                 |               |--- event ------->|--- notify B --->|
   |                 |                 |               |                  |                 |


ğŸ”¹ æµç¨‹è§£é‡‹
Client A ä¸Šç·š
èˆ‡ WS Server 1 å»ºç«‹ WebSocketã€‚
Server 1 åœ¨ Redis å¯«å…¥ç‹€æ…‹ = onlineã€‚
åŒæ™‚é€é NATS/Redis PubSub å»£æ’­ "user:123 online"ã€‚
Client B è¨‚é–±åˆ°äº‹ä»¶
Client B é€£åˆ° WS Server 2ã€‚
WS Server 2 æ”¶åˆ° NATS å»£æ’­ â†’ è½‰ç™¼çµ¦ Client B â†’ å³æ™‚é¡¯ç¤º A ä¸Šç·šã€‚
å¿ƒè·³å­˜æ´»
Client A èˆ‡ WS Server 1 å®šæœŸäº¤æ› ping/pongï¼Œç¢ºä¿é€£ç·šæ­£å¸¸ã€‚
è‹¥è¶…æ™‚æœªæ”¶åˆ° pongï¼ŒServer 1 èªå®š Client A æ‰ç·šã€‚
Client A é›¢ç·š
é€£ç·šæ–·é–‹æ™‚ï¼ŒServer 1 æ›´æ–° Redis â†’ user:123=offlineã€‚
å»£æ’­ user:123 offline çµ¦æ‰€æœ‰ WS Serverã€‚
WS Server 2 é€šçŸ¥ Client B â†’ ç«‹åˆ»é¡¯ç¤º A é›¢ç·šã€‚

ğŸ”¹ å¥½è™•
ä½å»¶é²ï¼šNATS/Redis PubSub äº‹ä»¶å‚³æ’­é€šå¸¸åœ¨æ¯«ç§’ç´šã€‚
å¤šå¯¦ä¾‹åŒæ­¥ï¼šç„¡è«– A/B é€£åˆ°å“ªå€‹ WS Serverï¼Œéƒ½èƒ½å³æ™‚çŸ¥é“å°æ–¹ç‹€æ…‹ã€‚
API æŸ¥è©¢ä¸€è‡´æ€§ï¼šå¥½å‹åˆ—è¡¨æŸ¥è©¢æ™‚ç›´æ¥è®€ Redisï¼Œä¸å¿…ä¾è³´ WSã€‚

